# 样式系统

<cite>
**本文档中引用的文件**  
- [uno.config.ts](file://apps/stage-web/uno.config.ts)
- [main.css](file://apps/stage-web/src/styles/main.css)
- [transitions.css](file://apps/stage-web/src/styles/transitions.css)
- [vue-transitions.css](file://apps/stage-web/src/styles/vue-transitions.css)
- [uno.config.ts](file://uno.config.ts)
- [index.css](file://packages/font-cjkfonts-allseto/src/index.css)
- [index.css](file://packages/font-departure-mono/src/index.css)
- [index.css](file://packages/font-xiaolai/src/index.css)
</cite>

## 目录
1. [简介](#简介)
2. [UnoCSS 配置与主题系统](#unocss-配置与主题系统)
3. [自定义字体配置](#自定义字体配置)
4. [动画与过渡系统](#动画与过渡系统)
5. [全局样式规则](#全局样式规则)
6. [扩展指南](#扩展指南)
7. [性能优化策略](#性能优化策略)

## 简介
本项目采用原子化 CSS 框架 UnoCSS 实现高效、可维护的样式系统。通过预设配置、自定义主题变量和模块化过渡动画，实现了高性能渲染与一致的视觉体验。样式系统涵盖字体管理、颜色主题、过渡动画及全局样式规则，支持灵活扩展。

## UnoCSS 配置与主题系统

### 核心配置结构
项目采用分层配置模式，`apps/stage-web/uno.config.ts` 继承自根目录的共享配置 `uno.config.ts`，通过 `mergeConfigs` 合并基础样式与项目特定规则。

UnoCSS 集成多种预设：
- `presetWind3`：提供类 Tailwind 的实用类语法
- `presetAttributify`：支持属性化语法（如 `bg="blue-500"`）
- `presetIcons`：集成图标系统
- `presetTypography`：排版优化
- `presetChromatic`：基于色相的动态主题系统
- `presetWebFonts`：字体加载管理

### 自定义主题变量
通过 CSS 自定义属性实现主题切换：
```css
:root {
  --bg-color-light: rgb(255 255 255);
  --bg-color-dark: rgb(18 18 18);
  --bg-color: var(--bg-color-light);
}
```
暗色模式通过 `html.dark` 类激活，自动切换背景色并应用 `color-scheme: dark`，确保系统级外观一致性。

**Section sources**
- [main.css](file://apps/stage-web/src/styles/main.css#L1-L10)
- [uno.config.ts](file://uno.config.ts#L150-L263)

## 自定义字体配置

### 字体定义与加载
项目通过 `presetWebFonts` 配置多种字体家族，支持本地与远程加载。关键字体包括：

- **无衬线体**：`DM Sans`（默认）、`Comfortaa`、`Urbanist`
- **衬线体**：`DM Serif Display`
- **等宽字体**：`DM Mono`、`Departure Mono`
- **中文字体**：`cjkfonts AllSeto`（全集园字体）、`Xiaolai SC`（晓来体）
- **特色字体**：`Kiwi Maru`（日系可爱风）、`Sniglet`（英文圆润体）

本地字体通过 `provider: 'none'` 声明，并由 `@proj-airi/unocss-preset-fonts` 预设自动导入 CSS 文件。

### 字体家族映射
在 `theme.fontFamily` 中定义复合字体栈，确保优雅降级：
```ts
'sans': `"DM Sans Variant", "DM Sans", ui-sans-serif, system-ui, sans-serif, ...`,
'cute': `"Sniglet", "Kiwi Maru", "Comfortaa", "xiaolai", ...`,
```
`cute` 字体栈专为角色界面设计，融合中英日特色字体，营造统一的二次元视觉风格。

### 本地字体实现
通过 `@font-face` 规则加载本地字体资源：
```css
/* cjkfonts_allseto_v1.11 */
@font-face {
  font-family: 'cjkfonts AllSeto';
  src: url(./files/cjkFonts_allseto_v1.11.ttf) format('truetype');
}
```
所有本地字体文件存放于对应 `packages/font-*` 模块的 `files/` 目录中，通过 npm 包形式统一管理。

**Section sources**
- [uno.config.ts](file://uno.config.ts#L70-L127)
- [uno.config.ts](file://apps/stage-web/uno.config.ts#L1-L26)
- [index.css](file://packages/font-cjkfonts-allseto/src/index.css#L1-L8)
- [index.css](file://packages/font-departure-mono/src/index.css#L1-L8)
- [index.css](file://packages/font-xiaolai/src/index.css#L1-L8)

## 动画与过渡系统

### 原子化动画类
UnoCSS 在 `theme.animation` 中预定义关键帧动画，支持通过类名直接调用：
```ts
theme: {
  animation: {
    keyframes: {
      fadeIn: '{from{opacity:0;}to{opacity:1;}}',
      slideUpAndFade: '{from{opacity:0;transform:translateY(2px)}to{opacity:1;transform:translateY(0)}}',
      // ...其他动画
    },
    durations: { fadeIn: '200ms', slideUpAndFade: '400ms' },
    timingFns: { fadeIn: 'ease-in-out' }
  }
}
```
使用示例：`animate-fadeIn`、`animate-slideUpAndFade`。

### 自定义过渡规则
在 `uno.config.ts` 中通过 `rules` 添加特殊过渡类：
```ts
['transition-colors-none', {
  'transition-property': 'color, background-color, border-color, text-color',
  'transition-duration': '0s',
}]
```
此规则用于禁用特定元素的颜色过渡效果，提升交互响应速度。

### CSS 过渡类实现
项目定义了两套过渡样式文件：

#### 通用过渡（transitions.css）
```css
.slide-away-enter-active,
.slide-away-leave-active {
  transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
}

.slide-away-enter,
.slide-away-leave-to {
  transform: translateY(-10px);
  opacity: 0;
}
```
实现元素进出时的滑动淡入淡出效果。

#### Vue 专属过渡（vue-transitions.css）
针对 Vue 的 `<transition>` 组件定义命名过渡：
- `fade-slide-out-r-to-l`：右进左出淡入淡出
- `fade-slide-out-l-to-r`：左进右出淡入淡出
- `fade`：基础淡入淡出

这些类可直接在 Vue 模板中使用：
```vue
<transition name="fade-slide-out-r-to-l">
  <div>内容</div>
</transition>
```

**Section sources**
- [uno.config.ts](file://uno.config.ts#L200-L250)
- [uno.config.ts](file://apps/stage-web/uno.config.ts#L20-L26)
- [transitions.css](file://apps/stage-web/src/styles/transitions.css#L1-L19)
- [vue-transitions.css](file://apps/stage-web/src/styles/vue-transitions.css#L1-L49)

## 全局样式规则

### 布局与重置
`main.css` 导入所有过渡样式，并设置基础布局：
```css
html, body, #app {
  height: 100%;
  margin: 0;
  padding: 0;
  overscroll-behavior: none;
}
```
确保应用占据全屏且禁用滚动溢出效果。

### 触摸设备优化
```css
* {
  touch-action: manipulation;
}
```
禁用双击缩放，提升移动端交互体验。

### 进度条样式
集成 NProgress 的自定义样式，使用 `color-mix` 动态生成基于主题色的进度条颜色，并在 PWA 模式下自动隐藏。

**Section sources**
- [main.css](file://apps/stage-web/src/styles/main.css#L1-L65)

## 扩展指南

### 添加新字体
1. 将字体文件放入 `packages/font-<name>/src/files/`
2. 在 `packages/font-<name>/src/index.css` 添加 `@font-face` 规则
3. 在 `packages/unocss-preset-fonts/src/index.ts` 的预设中注册字体
4. 在 `uno.config.ts` 的 `presetWebFontsFonts` 中添加字体映射

### 定义新动画
1. 在 `uno.config.ts` 的 `theme.animation.keyframes` 中添加关键帧
2. 设置对应的 `durations` 和 `timingFns`
3. 使用 `animate-<name>` 类在模板中调用

### 扩展主题变量
1. 在 `:root` 中添加新的 `--custom-var` 变量
2. 在 `html.dark` 中定义暗色模式值
3. 通过 `var(--custom-var)` 在 CSS 或 UnoCSS 规则中使用

## 性能优化策略
- **原子化生成**：UnoCSS 按需生成 CSS，避免未使用样式的体积膨胀
- **字体懒加载**：通过 `timeouts` 配置优化字体加载失败处理
- **过渡分离**：将复杂过渡逻辑拆分为独立 CSS 文件，减少主样式表体积
- **预设复用**：跨项目共享 `sharedUnoConfig`，确保一致性并减少重复配置