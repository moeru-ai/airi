# 数据可视化组件

<cite>
**本文档中引用的文件**  
- [AudioSpectrum.vue](file://packages/stage-ui/src/components/gadgets/AudioSpectrum.vue)
- [LevelMeter.vue](file://packages/stage-ui/src/components/gadgets/LevelMeter.vue)
- [ThresholdMeter.vue](file://packages/stage-ui/src/components/gadgets/ThresholdMeter.vue)
- [TimeSeriesChart.vue](file://packages/stage-ui/src/components/gadgets/TimeSeriesChart.vue)
- [ChatBubbleMinimalism.vue](file://packages/stage-ui/src/components/gadgets/ChatBubbleMinimalism.vue)
</cite>

## 目录
1. [简介](#简介)
2. [核心组件概览](#核心组件概览)
3. [音频可视化组件](#音频可视化组件)
   - [AudioSpectrum](#audiospectrum)
   - [LevelMeter](#levelmeter)
4. [状态可视化组件](#状态可视化组件)
   - [ThresholdMeter](#thresholdmeter)
   - [TimeSeriesChart](#timeserieschart)
5. [聊天交互可视化组件](#聊天交互可视化组件)
   - [ChatBubbleMinimalism](#chatbubbleminimalism)
6. [性能优化与最佳实践](#性能优化与最佳实践)
7. [集成示例](#集成示例)
8. [结论](#结论)

## 简介
`stage-ui` 提供了一套用于音频、系统状态和聊天交互的数据可视化组件。这些组件专为实时数据展示设计，支持动画、响应式布局和主题定制。本文档详细说明了 `AudioSpectrum`、`LevelMeter`、`ThresholdMeter`、`TimeSeriesChart` 和 `ChatBubbleMinimalism` 组件的使用方法、属性、事件和插槽，并提供实际应用示例和性能优化建议。

## 核心组件概览
`stage-ui` 的数据可视化组件位于 `packages/stage-ui/src/components/gadgets/` 目录下，主要包括：
- **音频可视化**：`AudioSpectrum`、`LevelMeter`
- **状态可视化**：`ThresholdMeter`、`TimeSeriesChart`
- **聊天交互**：`ChatBubbleMinimalism`

这些组件通过响应式设计和动画支持，能够有效提升用户界面的交互体验。

**Section sources**
- [AudioSpectrum.vue](file://packages/stage-ui/src/components/gadgets/AudioSpectrum.vue)
- [LevelMeter.vue](file://packages/stage-ui/src/components/gadgets/LevelMeter.vue)
- [ThresholdMeter.vue](file://packages/stage-ui/src/components/gadgets/ThresholdMeter.vue)
- [TimeSeriesChart.vue](file://packages/stage-ui/src/components/gadgets/TimeSeriesChart.vue)
- [ChatBubbleMinimalism.vue](file://packages/stage-ui/src/components/gadgets/ChatBubbleMinimalism.vue)

## 音频可视化组件

### AudioSpectrum
`AudioSpectrum` 组件用于可视化音频频谱，支持从 `MediaStream` 实时获取音频数据并生成频谱图。

#### Props
- `stream`：`MediaStream` 对象，用于音频分析
- `bars`：频谱条数量，默认 32
- `minFreq`：最低频率（Hz），默认 60
- `maxFreq`：最高频率（Hz），默认 4000

#### 插槽
- 默认插槽：接收 `frequencies` 数组，包含归一化的频谱数据（0-1）

#### 工作原理
组件使用 `Web Audio API` 创建 `AnalyserNode`，通过 `getByteFrequencyData` 获取频率数据，并在指定频率范围内进行分组平均，最终输出归一化数据供插槽使用。

**Section sources**
- [AudioSpectrum.vue](file://packages/stage-ui/src/components/gadgets/AudioSpectrum.vue)

### LevelMeter
`LevelMeter` 组件用于显示数值水平，常用于音量、信号强度等场景。

#### Props
- `level`：当前值
- `min`：最小值，默认 0
- `max`：最大值，默认 100
- `numBars`：条形数量，默认 20
- `label`：显示标签，默认 "Level"
- `unit`：单位，默认 "%"
- `height`：高度（像素），默认 24
- `showHeader`：是否显示头部信息，默认 true
- `animationSpeed`：动画速度（ms），默认 75
- `colorThresholds`：颜色阈值数组，定义不同区间的颜色
- `formatValue`：自定义值格式化函数

#### 功能特性
- 支持自定义颜色阈值
- 响应式动画过渡
- 可自定义值显示格式

**Section sources**
- [LevelMeter.vue](file://packages/stage-ui/src/components/gadgets/LevelMeter.vue)

## 状态可视化组件

### ThresholdMeter
`ThresholdMeter` 组件用于显示带阈值的水平指示器，可区分阈值上下状态。

#### Props
- `value`：当前值（0-1）
- `threshold`：阈值（0-1）
- `min`：最小值，默认 0
- `max`：最大值，默认 1
- `numBars`：条形数量，默认 20
- `label`：标签，默认 "Value"
- `unit`：单位，默认 "%"
- `precision`：小数精度，默认 1
- `height`：高度，默认 24
- `showHeader`：显示头部，默认 true
- `showLegend`：显示图例，默认 true
- `animationSpeed`：动画速度，默认 100
- `belowThresholdClass`：阈值下样式类
- `aboveThresholdClass`：阈值上样式类
- `thresholdBarClass`：阈值条样式类
- `inactiveBarClass`：非激活条样式类
- `belowLabel`：阈值下标签
- `aboveLabel`：阈值上标签
- `thresholdLabel`：阈值标签
- `formatValue`：值格式化函数

#### 图例显示
组件支持显示颜色图例，帮助用户理解不同颜色区域的含义。

**Section sources**
- [ThresholdMeter.vue](file://packages/stage-ui/src/components/gadgets/ThresholdMeter.vue)

### TimeSeriesChart
`TimeSeriesChart` 组件用于显示时间序列数据，支持阈值、区域填充和状态指示。

#### Props
- `history`：历史数据数组（归一化 0-1）
- `currentValue`：当前值（0-1）
- `threshold`：阈值（0-1），可为空
- `isActive`：是否处于激活状态
- `title`：图表标题
- `colorsHue`：颜色色调
- `lineColor`：线条颜色
- `thresholdColor`：阈值颜色
- `activeColor`：激活状态颜色
- `inactiveColor`：非激活状态颜色
- `subtitle`：副标题
- `activeLabel`：激活标签
- `activeLegendLabel`：激活图例标签
- `inactiveLegendLabel`：非激活图例标签
- `thresholdLabel`：阈值标签
- `height`：图表高度，默认 80
- `lineWidth`：线条宽度，默认 1.5
- `minDataPoints`：最小数据点数，默认 5
- `precision`：精度，默认 0
- `unit`：单位，默认 "%"
- `showHeader`：显示头部，默认 true
- `showThreshold`：显示阈值，默认 true
- `showArea`：显示填充区域，默认 true
- `showThresholdAreas`：显示阈值区域，默认 true
- `showCurrentValue`：显示当前值，默认 true
- `showActiveIndicator`：显示激活指示器，默认 true
- `showLegend`：显示图例，默认 true
- `formatValue`：值格式化函数

#### 可视化特性
- 平滑曲线路径
- 渐变填充区域
- 网格背景
- 阈值虚线
- 激活状态指示器
- 浮动当前值显示

**Section sources**
- [TimeSeriesChart.vue](file://packages/stage-ui/src/components/gadgets/TimeSeriesChart.vue)

## 聊天交互可视化组件

### ChatBubbleMinimalism
`ChatBubbleMinimalism` 组件用于显示极简风格的聊天气泡，支持文本流和加载状态。

#### Props
- `containerClass`：容器类名
- `containerClassExtra`：额外容器类名
- `text`：文本内容，支持字符串或 `ReadableStream`
- `textClass`：文本类名
- `side`：位置，"left" 或 "right"，默认 "right"
- `loading`：加载状态

#### 动画特性
- 气泡展开动画（宽度、内边距、边框）
- 使用 `animejs` 创建时间线动画
- 文本分割动画（通过 `PoppinText` 组件）

#### 内部组件
- 使用 `PoppinText` 组件处理文本动画
- 支持流式文本渲染
- 自动滚动到底部

**Section sources**
- [ChatBubbleMinimalism.vue](file://packages/stage-ui/src/components/gadgets/ChatBubbleMinimalism.vue)

## 性能优化与最佳实践

### 实时数据更新
- 使用 `requestAnimationFrame` 进行频谱分析
- 合理设置 `animationSpeed` 避免过度重绘
- 对于 `TimeSeriesChart`，控制 `history` 数组长度避免内存泄漏

### 动画配置
- 使用 CSS 过渡类（如 `transition-all`）实现平滑动画
- 合理设置动画持续时间（`duration-*`）
- 对于复杂动画，使用 `animejs` 等专业库

### 性能建议
- 频谱分析时合理设置 `fftSize`（当前为 2048）
- 避免在高频更新组件中使用复杂计算
- 使用 `computed` 属性缓存计算结果
- 对于大量数据，考虑数据降采样

### 主题与样式
- 支持通过 `colorsHue` 自定义色调
- 使用 CSS 变量（如 `--chromatic-hue`）实现主题切换
- 支持深色模式（通过 `dark:` 类）

## 集成示例

### 音频可视化集成
```vue
<AudioSpectrum :stream="audioStream" :bars="32">
  <template #default="{ frequencies }">
    <div class="flex h-20 gap-1">
      <div
        v-for="(freq, i) in frequencies"
        :key="i"
        class="flex-1 bg-primary-500"
        :style="{ height: `${freq * 100}%` }"
      />
    </div>
  </template>
</AudioSpectrum>
```

### 状态监控集成
```vue
<TimeSeriesChart
  :history="cpuHistory"
  :currentValue="cpuUsage"
  :threshold="0.8"
  :isActive="systemActive"
  title="CPU 使用率"
  unit="%"
  showThreshold
  showArea
/>
```

### 聊天界面集成
```vue
<ChatBubbleMinimalism
  v-for="message in messages"
  :key="message.id"
  :text="message.content"
  :side="message.sender === 'user' ? 'right' : 'left'"
/>
```

## 结论
`stage-ui` 的数据可视化组件提供了完整的音频、状态和聊天交互可视化解决方案。通过合理的属性设计和插槽机制，这些组件具有高度的可定制性和复用性。结合性能优化建议，开发者可以创建流畅、美观的数据可视化界面，提升用户体验。