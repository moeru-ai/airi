# AIRI 项目配置文件详解

本文档详细介绍 AIRI 项目中各个配置文件的作用、配置项说明以及使用场景。

---

## 目录

- [一、项目根目录配置](#一项目根目录配置)
  - [1. package.json](#1-packagejson)
  - [2. pnpm-workspace.yaml](#2-pnpm-workspaceyaml)
  - [3. turbo.json](#3-turbojson)
  - [4. tsconfig.json](#4-tsconfigjson)
  - [5. Cargo.toml](#5-cargotoml)
  - [6. eslint.config.js](#6-eslintconfigjs)
  - [7. uno.config.ts](#7-unoconfigts)
  - [8. vitest.config.ts](#8-vitestconfigts)
- [二、Rust 工具链配置](#二rust-工具链配置)
  - [1. rust-toolchain.toml](#1-rust-toolchaintoml)
  - [2. rustfmt.toml](#2-rustfmttoml)
- [三、开发工具配置](#三开发工具配置)
  - [1. cspell.config.yaml](#1-cspellconfigyaml)
  - [2. crowdin.yml](#2-crowdinyml)
  - [3. bump.config.ts](#3-bumpconfigts)
- [四、IDE 与编辑器配置](#四ide-与编辑器配置)
  - [1. .vscode/extensions.json](#1-vscodeextensionsjson)
  - [2. .vscode/settings.json](#2-vscodesettingsjson)
  - [3. .vscode/launch.json](#3-vscodelaunchjson)
  - [4. .editorconfig](#4-editorconfig)
- [五、版本控制配置](#五版本控制配置)
  - [1. .gitignore](#1-gitignore)
  - [2. .githooks/pre-commit.js](#2-githookspre-commitjs)
- [六、构建与部署配置](#六构建与部署配置)
  - [1. flake.nix](#1-flakenix)
  - [2. nix/package.nix](#2-nixpackagenix)
  - [3. Dockerfile](#3-dockerfile)
  - [4. .dockerignore](#4-dockerignore)
- [七、应用级配置](#七应用级配置)
  - [1. stage-web/vite.config.ts](#1-stage-webviteconfigts)
  - [2. stage-tamagotchi/electron.vite.config.ts](#2-stage-tamagotchielectronviteconfigts)
  - [3. stage-tamagotchi/electron-builder.yml](#3-stage-tamagotchielectron-builderyml)
- [八、其他配置](#八其他配置)
  - [1. .tool-versions](#1-tool-versions)
  - [2. .gemini/config.yaml](#2-geminiconfigyaml)

---

## 一、项目根目录配置

### 1. package.json

**文件路径**: `/package.json`

**作用**: Node.js 项目的核心配置文件，定义项目元数据、依赖、脚本命令等。

#### 主要配置项说明

| 配置项 | 值 | 说明 |
|--------|-----|------|
| `name` | `@proj-airi/root` | 项目包名，使用 scoped 命名 |
| `version` | `0.7.2-beta.3` | 当前版本号 |
| `type` | `module` | 使用 ES Module 模块系统 |
| `packageManager` | `pnpm@10.20.0` | 指定包管理器及版本 |
| `private` | `true` | 标记为私有包，不发布到 npm |

#### 脚本命令 (scripts)

| 命令 | 作用 |
|------|------|
| `pnpm dev` | 启动 Web 应用开发服务器 |
| `pnpm dev:docs` | 启动文档开发服务器 |
| `pnpm dev:ui` | 启动 UI 组件库 Storybook |
| `pnpm dev:tamagotchi` | 启动桌面应用开发模式 |
| `pnpm build` | 构建所有包和应用 |
| `pnpm build:web` | 仅构建 Web 应用 |
| `pnpm build:tamagotchi` | 构建桌面应用 |
| `pnpm test` | 运行测试并生成覆盖率报告 |
| `pnpm lint` | 代码检查 |
| `pnpm lint:rust` | Rust 代码格式检查和 clippy |
| `pnpm typecheck` | TypeScript 类型检查 |

#### workspaces 配置

定义 monorepo 工作空间：
```json
"workspaces": [
  "packages/**",
  "plugins/**",
  "services/**",
  "examples/**",
  "docs/**",
  "apps/**"
]
```

#### pnpm 特定配置

- **overrides**: 覆盖特定依赖版本，用于安全修复和 polyfill
- **onlyBuiltDependencies**: 仅对这些原生依赖执行构建

#### Git Hooks 配置

```json
"simple-git-hooks": {
  "pre-commit": "pnpm lint-staged"
},
"lint-staged": {
  "*": "pnpm -s exec oxlint --fix"
}
```

提交前自动执行 lint 检查和修复。

---

### 2. pnpm-workspace.yaml

**文件路径**: `/pnpm-workspace.yaml`

**作用**: 定义 pnpm monorepo 工作空间结构。

#### 配置内容

```yaml
packages:
  - packages/**
  - plugins/**
  - services/**
  - examples/**
  - docs/**
  - apps/**
  - '!**/dist/**' # 排除构建产物
```

#### Catalog 功能

pnpm 的 catalog 功能用于统一管理共享依赖版本：

```yaml
catalog:
  '@guiiai/logg': 1.1.0
  '@moeru/eslint-config': 0.1.0-beta.13
  '@xsai/embed': ^0.4.0-beta.5
  # ... 更多共享依赖

catalogs:
  rolldown-vite:
    vite: npm:rolldown-vite@^7.1.20
```

子包可通过 `catalog:` 引用统一版本：
```json
{
  "dependencies": {
    "@guiiai/logg": "catalog:"
  }
}
```

---

### 3. turbo.json

**文件路径**: `/turbo.json`

**作用**: Turborepo 构建系统配置，优化 monorepo 构建流程。

#### 配置内容

```json
{
  "$schema": "https://turborepo.com/schema.json",
  "tasks": {
    "build": {
      "outputs": ["dist/**"]
    }
  }
}
```

#### 配置说明

- **$schema**: JSON Schema 引用，提供 IDE 智能提示
- **tasks.build**: 定义 build 任务
  - `outputs`: 声明构建产物目录，用于缓存和增量构建

Turbo 会根据依赖关系图并行执行任务，并缓存构建结果以提高效率。

---

### 4. tsconfig.json

**文件路径**: `/tsconfig.json`

**作用**: TypeScript 编译器根配置，作为项目基础配置被各子包继承。

#### 配置项说明

```json
{
  "compilerOptions": {
    "target": "ESNext", // 编译目标版本
    "module": "ESNext", // 模块系统
    "moduleResolution": "Bundler", // 模块解析策略（适配打包工具）
    "resolveJsonModule": true, // 允许导入 JSON 模块
    "strictNullChecks": true, // 严格的 null 检查
    "noFallthroughCasesInSwitch": true, // 防止 switch 穿透
    "noUnusedLocals": true, // 检查未使用的局部变量
    "noUnusedParameters": true, // 检查未使用的参数
    "noEmit": true, // 不生成输出文件（由打包工具处理）
    "allowSyntheticDefaultImports": true, // 允许合成默认导入
    "esModuleInterop": true, // ES 模块互操作性
    "verbatimModuleSyntax": true, // 精确的模块语法
    "skipLibCheck": true // 跳过类型库检查
  },
  "exclude": [
    "**/dist/**",
    "node_modules"
  ]
}
```

---

### 5. Cargo.toml

**文件路径**: `/Cargo.toml`

**作用**: Rust 工作空间根配置，管理所有 Rust crate。

#### 工作空间成员

```toml
[workspace]
members = [
  "crates/tauri-plugin-ipc-audio-transcription-ort",
  "crates/tauri-plugin-ipc-audio-vad-ort",
  "crates/tauri-plugin-mcp",
  "crates/tauri-plugin-rdev",
  "crates/tauri-plugin-window-pass-through-on-hover",
  "crates/tauri-plugin-window-router-link",
  "apps/stage-tamagotchi/src-tauri"
]
resolver = "2" # 使用新版依赖解析器
```

#### 工作空间级别配置

```toml
[workspace.package]
version = "0.7.2-beta.3" # 统一版本号

[workspace.dependencies]
# 内部 crate 路径引用
tauri-plugin-mcp = { path = "./crates/tauri-plugin-mcp" }
```

#### 编译配置

```toml
[profile.dev]
incremental = true # 增量编译
opt-level = 0 # 开发模式不优化
debug = true # 包含调试信息

[profile.dev.package."*"]
opt-level = 1 # 依赖库轻度优化
debug = false # 依赖库不包含调试信息
```

#### 补丁配置

```toml
[patch.crates-io]
esaxx-rs = { path = "apps/stage-tamagotchi/src-tauri/libs/esaxx-rs" }
```

用于本地覆盖 crates.io 上的依赖。

---

### 6. eslint.config.js

**文件路径**: `/eslint.config.js`

**作用**: ESLint 代码检查配置，使用扁平配置格式（Flat Config）。

#### 配置结构

```javascript
import { defineConfig } from '@moeru/eslint-config'

export default defineConfig({
  // 功能开关
  masknet: false,
  preferArrow: false,
  perfectionist: false,
  sonarjs: false,
  sortPackageJsonScripts: false,
  typescript: true,
  unocss: true,
  vue: true,
}, {
  // 忽略文件
  ignores: [
    'cspell.config.yaml',
    'crowdin.yml',
    '**/assets/js/**',
    'apps/stage-tamagotchi/out/**',
    'crates/**',
    // ...
  ],
}, {
  // 自定义规则
  rules: {
    'antfu/import-dedupe': 'error',
    'no-console': ['error', { allow: ['warn', 'error', 'info'] }],
    'perfectionist/sort-imports': ['error', { /* 导入排序配置 */ }],
    // ...
  },
})
```

#### 主要特性

- 基于 `@moeru/eslint-config` 预设配置
- 支持 TypeScript、Vue、UnoCSS
- 自定义导入排序规则
- 禁止 console.log（仅允许 warn/error/info）

---

### 7. uno.config.ts

**文件路径**: `/uno.config.ts`

**作用**: UnoCSS 原子化 CSS 框架配置。

#### 预设配置

```typescript
presets: [
  presetWind3(), // Tailwind CSS 3 兼容
  presetAttributify(), // 属性化模式
  presetTypography(), // 排版预设
  presetIcons({ // 图标预设
    scale: 1.2,
    collections: {
      ...createExternalPackageIconLoader('@proj-airi/lobe-icons'),
    },
  }),
  presetScrollbar(), // 滚动条样式
  presetChromatic({ // 色彩主题
    baseHue: 220.44,
    colors: {
      primary: 0,
      complementary: 180,
    },
  }),
]
```

#### 字体配置

定义项目使用的字体栈：
```typescript
fontFamily: {
  'sans': 'DM Sans...',
  'sans-rounded': 'Comfortaa...',
  'cute': 'Sniglet, Kiwi Maru...',
  'cuteen': 'Sniglet, Kiwi Maru...',
  'cutejp': 'Sniglet, Kiwi Maru...',
}
```

#### 动画配置

定义自定义动画关键帧：
```typescript
animation: {
  keyframes: {
    overlayShow: '{from{opacity:0;}to{opacity:1;}}',
    slideUpAndFade: '{from{opacity:0;transform:translateY(2px)}to{...}}',
    fadeIn: '{from{opacity:0;}to{opacity:1;}}',
    // ...
  },
  durations: {
    overlayShow: '300ms',
    fadeIn: '200ms',
    // ...
  }
}
```

#### 内容扫描配置

```typescript
content: {
  pipeline: {
    include: [
      /\.(vue|svelte|[jt]sx|mdx?|astro|elm|php|phtml|html)($|\?)/,
      '(components|src)/**/*.{js,ts,vue}',
      '**/stage-ui/**/*.{vue,js,ts}',
      '**/ui/**/*.{vue,js,ts}',
    ],
    exclude: [
      /\/node_modules\//,
    ],
  },
}
```

---

### 8. vitest.config.ts

**文件_path**: `/vitest.config.ts`

**作用**: Vitest 测试框架配置。

#### 配置内容

```typescript
import { defineConfig } from 'vitest/config'

export default defineConfig({
  test: {
    projects: [
      'packages/injecta',
      'packages/stage-ui',
    ],
  },
})
```

#### 说明

- 使用 workspace 模式管理多个测试项目
- 每个子项目可以有独立的 vitest 配置
- 覆盖率报告通过 `--coverage` 参数生成

---

## 二、Rust 工具链配置

### 1. rust-toolchain.toml

**文件路径**: `/rust-toolchain.toml`

**作用**: 定义 Rust 工具链版本和组件。

#### 配置内容

```toml
[toolchain]
channel = "nightly-2025-05-25" # 使用特定 nightly 版本
components = [
  "rustc", # 编译器
  "cargo", # 包管理器
  "rustfmt", # 格式化工具
  "rust-analyzer", # LSP 服务器
  "clippy" # 代码检查工具
]
targets = [
  "x86_64-apple-darwin", # macOS Intel
  "aarch64-apple-darwin", # macOS Apple Silicon
  "x86_64-unknown-linux-gnu", # Linux x64
  "aarch64-unknown-linux-gnu", # Linux ARM64
  "x86_64-pc-windows-msvc" # Windows
]
profile = "minimal" # 最小安装配置
```

#### 说明

- 使用 nightly 版本以获取最新特性
- 配置所有目标平台以支持跨平台构建
- minimal profile 仅安装必要组件

---

### 2. rustfmt.toml

**文件_path**: `/rustfmt.toml`

**作用**: Rust 代码格式化配置。

#### 主要配置项

```toml
edition = "2024" # Rust 版本
tab_spaces = 2 # 缩进空格数
imports_indent = "Block" # 导入语句缩进
match_arm_leading_pipes = "Preserve" # match 分支管道符保留
group_imports = "StdExternalCrate" # 导入分组
imports_granularity = "Crate" # 导入粒度
imports_layout = "HorizontalVertical" # 导入布局
match_block_trailing_comma = true # match 块尾随逗号
use_field_init_shorthand = true # 字段初始化简写
use_try_shorthand = true # try! 宏简写
struct_field_align_threshold = 999 # 结构体字段对齐
enum_discrim_align_threshold = 999 # 枚举判别式对齐
unstable_features = true # 启用不稳定特性
```

---

## 三、开发工具配置

### 1. cspell.config.yaml

**文件路径**: `/cspell.config.yaml`

**作用**: CSpell 拼写检查配置。

#### 配置内容

```yaml
version: '0.2'
words:
  - airi
  - live2d
  - tauri
  - vite
  - unocss
  # ... 300+ 项目特定词汇
ignoreWords:
  - smol-toml
```

#### 说明

- `words`: 包含项目特定的技术词汇，避免误报
- 覆盖 Live2D、Tauri、WebGPU 等技术术语
- 支持代码注释、文档、配置文件拼写检查

---

### 2. crowdin.yml

**文件_path**: `/crowdin.yml`

**作用**: Crowdin 本地化平台配置。

#### 配置内容

```yaml
files:
  - source: packages/i18n/src/locales/en/**/*
    ignore:
      - '**/*.ts'
    translation: /packages/i18n/src/locales/%locale%/**/%original_file_name%
```

#### 说明

- 源语言文件位于 `packages/i18n/src/locales/en/`
- 翻译文件按 locale 目录组织
- 忽略 TypeScript 文件

---

### 3. bump.config.ts

**文件路径**: `/bump.config.ts`

**作用**: bumpp 版本发布工具配置。

#### 配置内容

```typescript
export default defineConfig({
  recursive: true, // 递归更新所有包版本
  commit: 'release: v%s', // 提交信息模板
  sign: true, // GPG 签名提交
  push: false, // 不自动推送
  all: true, // 提交所有更改
  execute: async () => {
    // 发布预检
    await x('pnpm', ['publish', '-r', '--access', 'public', '--no-git-checks', '--dry-run'])

    // 同步 Cargo.toml 版本
    // ...
  },
})
```

#### 功能

- 统一更新 package.json 和 Cargo.toml 版本
- 执行发布前预检
- 支持 GPG 签名

---

## 四、IDE 与编辑器配置

### 1. .vscode/extensions.json

**文件_path**: `/.vscode/extensions.json`

**作用**: VS Code 推荐扩展列表。

#### 推荐扩展

| 扩展 ID | 用途 |
|---------|------|
| `antfu.goto-alias` | 别名跳转支持 |
| `antfu.iconify` | Iconify 图标预览 |
| `antfu.pnpm-catalog-lens` | pnpm catalog 可视化 |
| `antfu.unocss` | UnoCSS 智能提示 |
| `dbaeumer.vscode-eslint` | ESLint 集成 |
| `EditorConfig.EditorConfig` | EditorConfig 支持 |
| `lokalise.i18n-ally` | 国际化辅助 |
| `rust-lang.rust-analyzer` | Rust 语言服务 |
| `streetsidesoftware.code-spell-checker` | 拼写检查 |
| `Vue.volar` | Vue 语言服务 |
| `vitest.explorer` | Vitest 测试浏览器 |

---

### 2. .vscode/settings.json

**文件路径**: `/.vscode/settings.json`

**作用**: VS Code 项目级设置。

#### 主要配置

```json
{
  // 国际化配置
  "i18n-ally.keystyle": "nested",
  "i18n-ally.localesPaths": ["packages/i18n/src/locales"],
  "i18n-ally.namespace": true,

  // Rust 分析器配置
  "rust-analyzer.cargo.extraEnv": {
    "MACOSX_DEPLOYMENT_TARGET": "10.13"
  },
  "rust-analyzer.cachePriming.enable": false,

  // ESLint 配置
  "eslint.validate": ["javascript", "typescript", "vue", "html", "json", "yaml"],
  "eslint.rules.customizations": [
    { "rule": "style/*", "severity": "off" }
    // ...
  ],

  // TypeScript 配置
  "typescript.preferences.includePackageJsonAutoImports": "off",
  "typescript.suggest.autoImports": false,

  // Rust 格式化
  "[rust]": {
    "editor.defaultFormatter": "rust-lang.rust-analyzer",
    "editor.formatOnSave": true
  }
}
```

---

### 3. .vscode/launch.json

**文件路径**: `/.vscode/launch.json`

**作用**: VS Code 调试配置。

#### 调试配置

| 配置名称 | 类型 | 用途 |
|----------|------|------|
| Debug Main Process | node | 调试 Electron 主进程 |
| Debug Renderer Process | chrome | 调试渲染进程 |
| Debug VSCode Extension | extensionHost | 调试 VS Code 扩展 |
| Debug All | compound | 同时调试主进程和渲染进程 |

#### 示例

```json
{
  "name": "Debug Main Process",
  "type": "node",
  "request": "launch",
  "runtimeExecutable": "${workspaceRoot}/node_modules/.bin/electron-vite",
  "runtimeArgs": ["--sourcemap"],
  "env": {
    "REMOTE_DEBUGGING_PORT": "9222"
  }
}
```

---

### 4. .editorconfig

**文件路径**: `/.editorconfig`

**作用**: 跨编辑器代码风格配置。

#### 配置内容

```ini
root = true

[*.toml]
indent_size = 4
indent_style = space
max_line_length = 100

[*.rs]
indent_size = 2
indent_style = space
max_line_length = 100

[*.{js,ts,vue,tsx,jsx,html,css,json,yaml,yml}]
indent_size = 2
indent_style = space

[*.md]
trim_trailing_whitespace = false  # Markdown 换行需要双空格

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
```

---

## 五、版本控制配置

### 1. .gitignore

**文件路径**: `/.gitignore`

**作用**: Git 忽略文件配置。

#### 主要忽略规则

| 类别 | 忽略内容 |
|------|----------|
| 系统文件 | `.DS_Store`, `.Trash/` |
| Node.js | `node_modules`, `*.log` |
| 构建产物 | `dist/`, `out/`, `target/` |
| 音频文件 | `*.pcm`, `*.wav`, `*.mp3` |
| 证书文件 | `*.pem`, `*.crt`, `*.key` |
| 缓存文件 | `.eslintcache`, `.turbo`, `.cache/` |
| 环境配置 | `*.local`, `.envrc` |
| IDE 配置 | `.idea`, `.temp` |
| 测试报告 | `coverage/` |
| 模型资源 | `public/assets/live2d/models/*`, `public/assets/vrm/models/*` |

---

### 2. .githooks/pre-commit.js

**文件路径**: `/.githooks/pre-commit.js`

**作用**: Git pre-commit 钩子脚本。

#### 功能

```javascript
// 跨平台 pre-commit 钩子
// 确保 PATH 包含 node_modules/.bin

const pnpmCmd = process.platform === 'win32' ? 'pnpm.cmd' : 'pnpm'
const res = spawnSync(pnpmCmd, ['lint-staged'], { stdio: 'inherit', env })
```

#### 特性

- 跨平台兼容（Windows/Linux/macOS）
- 自动将 `node_modules/.bin` 添加到 PATH
- 执行 lint-staged 进行代码检查

---

## 六、构建与部署配置

### 1. flake.nix

**文件_path**: `/flake.nix`

**作用**: Nix Flakes 构建配置，用于可重现的构建环境。

#### 输入和输出

```nix
{
  inputs.nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";

  outputs = { self, nixpkgs }:
    {
      # 格式化工具
      formatter = forAllSystems (system: nixfmt-tree);

      # 构建产物
      packages = {
        default = airi;
        airi = callPackage ./nix/package.nix {};
        airi-debug = callPackage ./nix/package.nix { debugBuild = true; };
      };

      # 开发环境
      devShells.default = mkShell {
        packages = [ nixd nixfmt-tree pnpm ];
      };
    };
}
```

#### 支持平台

- `x86_64-linux`
- `aarch64-linux`
- `x86_64-darwin`
- `aarch64-darwin`

---

### 2. nix/package.nix

**文件路径**: `/nix/package.nix`

**作用**: Nix 包定义，描述如何构建 AIRI 桌面应用。

#### 主要配置

```nix
rustPlatform.buildRustPackage {
  pname = "airi";
  version = "0.7.2-beta.3";

  # 依赖
  buildInputs = [
    glib
    onnxruntime  # ONNX 运行时
    openssl
    alsa-lib     # Linux 音频
    webkitgtk_4_1 # Linux WebKit
  ];

  # 构建阶段
  preBuild = ''
    pnpm run build:packages
  '';

  # 元信息
  meta = {
    description = "Self-hostable AI waifu / companion / VTuber";
    license = lib.licenses.unfree;  # 使用 Cubism SDK
  };
}
```

---

### 3. Dockerfile

**文件路径**: `/apps/stage-web/Dockerfile`

**作用**: Docker 镜像构建配置，用于部署 Web 应用。

#### 构建阶段

**构建阶段 (build-stage)**:
```dockerfile
FROM node:24-trixie
RUN corepack enable
COPY . .
RUN pnpm install --frozen-lockfile
RUN pnpm -F @proj-airi/stage-web run build
RUN pnpm -F @proj-airi/docs run build:base
```

**生产阶段 (production-stage)**:
```dockerfile
FROM nginx:stable-alpine
COPY --from=build-stage /app/apps/stage-web/dist /usr/share/nginx/html
EXPOSE 80
```

#### 特性

- 多阶段构建，优化镜像大小
- 同时构建 Web 应用、文档和 UI 组件库
- 使用 nginx 作为生产服务器

---

### 4. .dockerignore

**文件路径**: `/.dockerignore`

**作用**: Docker 构建时忽略的文件。

```
**/node_modules
**/dist
**/.temp
target
```

---

## 七、应用级配置

### 1. stage-web/vite.config.ts

**文件路径**: `/apps/stage-web/vite.config.ts`

**作用**: Web 应用 Vite 构建配置。

#### 主要插件

```typescript
plugins: [
  Info(), // 构建信息注入
  Yaml(), // YAML 文件支持
  VueMacros(), // Vue 宏扩展
  VueRouter(), // 文件系统路由
  Layouts(), // 布局系统
  Unocss(), // 原子化 CSS
  VitePWA(), // PWA 支持
  VueI18n(), // 国际化
  VueDevTools(), // Vue 开发工具
  DownloadLive2DSDK(), // 下载 Live2D SDK
  LFS(), // Git LFS 支持
  SpaceCard(), // HuggingFace Space 配置
]
```

#### 路径别名

```typescript
resolve: {
  alias: {
    '@proj-airi/i18n': 'packages/i18n/src',
    '@proj-airi/stage-ui': 'packages/stage-ui/src',
    '@proj-airi/stage-pages': 'packages/stage-pages/src',
    '@proj-airi/stage-shared': 'packages/stage-shared/src',
  }
}
```

---

### 2. stage-tamagotchi/electron.vite.config.ts

**文件_path**: `/apps/stage-tamagotchi/electron.vite.config.ts`

**作用**: Electron 桌面应用构建配置。

#### 多进程配置

```typescript
export default defineConfig({
  main: {
    plugins: [externalizeDepsPlugin()], // 主进程
  },
  preload: {
    plugins: [externalizeDepsPlugin()], // 预加载脚本
  },
  renderer: {
    // 渲染进程配置
    plugins: [
      // 定义环境变量
      {
        name: 'proj-airi:defines',
        config(ctx) {
          return {
            define: {
              'import.meta.env.RUNTIME_ENVIRONMENT': '\'electron\'',
              'import.meta.env.URL_MODE': ctx.mode === 'development' ? '\'server\'' : '\'file\'',
            }
          }
        }
      },
      // ... 其他插件
    ]
  }
})
```

---

### 3. stage-tamagotchi/electron-builder.yml

**文件路径**: `/apps/stage-tamagotchi/electron-builder.yml`

**作用**: Electron 应用打包配置。

#### 基本配置

```yaml
appId: ai.moeru.airi
productName: AIRI
directories:
  output: dist
  buildResources: build
```

#### 平台特定配置

**Windows**:
```yaml
win:
  executableName: airi
nsis:
  artifactName: ${productName}-${version}-windows-${arch}-setup.${ext}
  createDesktopShortcut: always
  oneClick: false
  allowToChangeInstallationDirectory: true
```

**macOS**:
```yaml
mac:
  entitlementsInherit: build/entitlements.mac.plist
  extendInfo:
    - NSMicrophoneUsageDescription: 'AIRI requires microphone access'
    - NSCameraUsageDescription: 'AIRI requires camera access'
```

**Linux**:
```yaml
linux:
  target: [deb, rpm]
  category: Utility
  synopsis: 'AI VTuber/Waifu chatbot app'
```

---

## 八、其他配置

### 1. .tool-versions

**文件路径**: `/.tool-versions`

**作用**: asdf 版本管理工具配置。

```
nodejs 24.9.0
```

指定项目使用的 Node.js 版本。

---

### 2. .gemini/config.yaml

**文件路径**: `/.gemini/config.yaml`

**作用**: Google Gemini AI 配置。

```yaml
ignore_patterns:
  - packages/i18n/src/**
```

忽略国际化文件，避免 AI 分析翻译内容。

---

## 总结

AIRI 项目采用了现代化的 monorepo 架构，配置文件涵盖了：

1. **包管理**: pnpm + Turborepo 构建系统
2. **类型系统**: TypeScript 严格模式
3. **代码质量**: ESLint + oxlint + CSpell
4. **样式系统**: UnoCSS 原子化 CSS
5. **测试框架**: Vitest
6. **桌面应用**: Electron + Tauri 双栈
7. **部署方式**: Docker + Nix Flakes

这套配置体系支持 Web 应用和桌面应用的并行开发，实现了高效的 monorepo 工程化实践。
